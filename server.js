const express=require("express");const fs=require("fs");const path=require("path");const app=express();const PORT=3001;app.use(express.json());const dataFilePath=path.join(__dirname,"user.json");function readData(){const jsonData=fs.readFileSync(dataFilePath);return JSON.parse(jsonData.toString())}function writeData(data){fs.writeFileSync(dataFilePath,JSON.stringify(data,null,2))}app.get("/characters",(req,res)=>{const data=readData();console.log("Sending characters:",data.characters);res.setHeader("Content-Type","application/json");res.send(JSON.stringify(data.characters,null,2))});app.get("/characters/:id",(req,res)=>{const data=readData();const id=parseInt(req.params.id);const character=data.characters.find(c=>c.id===id);if(character){res.json(character)}else{res.status(404).json({error:"Character not found"})}});app.post("/characters",(req,res)=>{const data=readData();const newCharacter=req.body;if(!newCharacter.name||!newCharacter.realName||!newCharacter.universe){return res.status(400).json({error:"Missing required fields"})}const maxId=data.characters.reduce((max,c)=>(c.id>max?c.id:max),0);newCharacter.id=maxId+1;data.characters.push(newCharacter);writeData(data);res.status(201).json(newCharacter)});app.put("/characters/:id",(req,res)=>{const data=readData();const id=parseInt(req.params.id);const index=data.characters.findIndex(c=>c.id===id);if(index===-1){return res.status(404).json({error:"Character not found"})}const updatedCharacter={...data.characters[index],...req.body,id};data.characters[index]=updatedCharacter;writeData(data);res.json(updatedCharacter)});app.delete("/characters/:id",(req,res)=>{const data=readData();const id=parseInt(req.params.id);const index=data.characters.findIndex(c=>c.id===id);if(index===-1){return res.status(404).json({error:"Character not found"})}data.characters.splice(index,1);writeData(data);res.status(204).send()});app.get("/test-characters",(req,res)=>{const testCharacters=[{id:1,name:"Spider-Man",realName:"Peter Parker",universe:"Earth-616"},{id:2,name:"Iron Man",realName:"Tony Stark",universe:"Earth-616"}];const jsonString=JSON.stringify(testCharacters,null,2);console.log("Response JSON string:",jsonString);res.setHeader("Content-Type","application/json");res.send(jsonString)});app.listen(PORT,()=>{console.log(`Server is running on http://localhost:${PORT}`)});
